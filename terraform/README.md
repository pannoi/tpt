# Terraform 

## Инфо

Terraform – это инструмент от компании Hashicorp, помогающий декларативно управлять инфраструктрой. В данном случае не приходится вручную создавать инстансы, сети и т.д. в консоли вашего облачного провайдера; достаточно написать конфигурацию, в которой будет изложено, как вы видите вашу будущую инфраструктуру. Такая конфигурация создается в человеко-читаемом текстовом формате. Если вы хотите изменить вашу инфраструктуру, то редактируете конфигурацию и запускаете terraform apply. Terraform направит вызовы API к вашему облачному провайдеру, чтобы привести инфраструктуру в соответствие с конфигурацией, указанной в этом файле.

Если перенести управление инфраструктурой в текстовые файлы, то открывается возможность вооружиться всеми излюбленными инструментами для управления исходным кодом и процессами, после чего переориентируем их для работы с инфраструктурой. Теперь инфраструктура подчиняется системам контроля версий (git), точно как исходный код, ее можно точно так же рецензировать или откатывать к более раннему состоянию, если что-нибудь пойдет неправильно.

> Официальная документация: https://www.terraform.io/docs/index.html

## Установка

Вам нужно установить terraform [official provider](https://www.terraform.io/), сейчас мы испольузем версию: `terraform version == v0.11.11`

Windows

Скачайте [Terraform.zip](https://releases.hashicorp.com/terraform/0.11.11/terraform_0.11.11_windows_amd64.zip) и разархивируйте в `C:\Windows\System32\` 

Linux

Скачайте [Terraform.zip](https://releases.hashicorp.com/terraform/0.11.11/terraform_0.11.11_linux_amd64.zip) и разархивируйте в `/usr/bin` 

## Аутентификация

Для того, чтобы аутентифицроваться в облаке, с помощью terraform, вам нужно использовать аутентификационный конфиг.
(На win10 использовать powwershell от имени администратора)

```bash
az login
```

## Инициализация

Инциализационный процесс запустит установка зависмостей и модулей, которые вы используете в скрипте
(На win10 использовать powwershell от имени администратора)

```bash
terraform init
```

## Сконфигурируйте перменные

Все переменные храняться в ```variables.tf```, вы можете их подстроить под ваш deployment


## Просмотр статуса

Terraform при запуске создает файл ```*.tfstate``` в которым храняться информация о состоянии инфраструктуры. Используя его вы можете посмтроеть статус инфраструктуры

- Детальный вид

```bash
terraform show
```

- Упрощенный вид

```bash
terraform state list
```

## Планирование 

Перед тем как запустить скрипт, лучше убедиться, какие ресурсы будут созданы/изменены/удалены. Для этого воспольузетесь командой и посмотрите, как использование скрипта изменит текущую инфраструктуру

```bash
terraform plan
```

## Применение

После того как вы убедились, что деплоеймент является валидным, вы можете запустить скрипт.

```bash
terraform apply
```

```bash
terraform apply -auto-approve
```

## Выводы

Внутри деплоймента вы можете конфигурировать выводы, например от ресурсов, которые будут созданые, с использованием генератора (например resource_id)

```bash
terraform output
```

## Уничтожение 

Если вам нужно удалить инфраструктуру, которую вы разворачивали этим скриптом, запустите команду:

```bash
terraform destroy
```

> P.S. Используется *.tfstate файл, убедитесь, что он существует
