# Ansible

## Инфо

Ansible это очень гибкий и легкий инструмент для написания сценариев автоматизации любой сложности. Вы можете описать в нем как простое окружение разработчика так сложную структуру крупного проекта с несколькими окружениями (dev/stage/prod).

> Официальная документация: http://docs.ansible.com/

# Установка

> Debian

Для начала нужно обновить список пакетов для установки, чтобы гарантировано получить последнюю версию нужного нам Ansible

```bash
sudo apt update
```

Так же стоит обновить уже установленные пакеты

```bash
sudo apt upgrade
```

Теперь установим Ansible

```bash
sudo apt install ansible
```

Для проверки того, что Ansible был установлен, выполните следующую команду:

```bash
ansible --version
```

Все блоки в Ansible, будь то плейбуки или варсы (переменные), начинаются с того, что мы прописываем в первую строку файла:

```bash
---
```

# Плейбуки

Ansible playbooks — это способ отправки команд на удалённые компьютеры с помощью скриптов. Вместо того, чтобы индивидуально использовать команды Ansible для удалённой настройки компьютеров из командной строки, вы можете настраивать целые сложные среды, передавая скрипт одной или нескольким системам.

Расширением файла, будь то плейбук / таски / переменные (vars), является .yml

> Структура блока в файле playbook.yml

```bash
---
- name: Install Packages
  hosts: all
  become: true
  roles:
    - role: tpt
```

## Таски

Ansible tasks - собственно это задачи, которые будут исполняться Ansibl-ом, по типу установки пакетов, запуска сервисов, распаковки, копирования и тому подобного.
С примером тасков можно ознакомится в разделе roles/tpt/tasks в данной документации.

Пример блока в task на установку пакетов, записанных в переменную packages

```bash
    - name: Install apcahe+php modules 
      apt:
          name: "{{ item }}" 
          update_cache: yes
          state: latest
      with_items: "{{ packages }}"
```

> Ознакомиться со всеми модулями можно тут: https://docs.ansible.com/ansible/2.3/list_of_all_modules.html

## Роли

Это способ сгруппировать несколько задач в один контейнер, чтобы эффективно автоматизировать работу с помощью понятной структуры каталогов.
Структура роли:

```bash
/home/user/ansible:
    playbook.yml
    roles:
        tpt:
            tasks:
                main.yml
            vars:
                main.yml
```

>В папке vars, в файле main.yml можно указать переменные, которые могут хранить в себе информацию, по типу списка приложений, текста и т.п.

/vars/main.yml

С примером переменных можно ознакомиться в разделе roles/tpt/vars в данной документации.
